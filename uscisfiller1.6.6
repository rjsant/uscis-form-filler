<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>USCIS PDF Filler</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
 
<style>
  /* Transition for all key elements */
  body, input, select, button, fieldset, #pdfPane, #formPane {
    transition: background 0.4s ease, color 0.4s ease, border-color 0.4s ease;
  }

  * { box-sizing: border-box; }

  /* Layout */
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    font-weight: 1000;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #f4f4f7;
    color: #222;
    font-size: 16px;
  }

  .container {
	  display: flex;
	  height: 100vh;
	  overflow: auto;
	  flex-direction: row;
	}

  #pdfPane {
    min-width: 250px;
    max-width: 90vw;
    width: 40%;
    padding: 1rem;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    border-radius: 10px;
	overflow-y: auto; /* ← new */
    height: 100vh;    /* ← new */
  }

  #formPane {
    flex: 1;
    padding: 1rem;
	height: 100vh;
    overflow-y: auto;
    background: #f7f7f7;
  }

  iframe {
    width: 100%;
    height: 100%;
	border: 1px solid #ccc;
	flex-grow: 1;
  }

  .resizer {
    width: 5px;
    background: #ccc;
    cursor: ew-resize;
  }

  /* Form Controls */
  fieldset {
    margin-bottom: 1rem;
    background: #ffffff;
    border: 1px solid #ccc;
    padding: 1rem;
    border-radius: 10px;
  }

  label {
    display: block;
    margin-bottom: 0.5em;
  }

  input, select, button, textarea {
    padding: 0.4em;
    font-size: 1em;
    border-radius: 6px;
  }

  button {
    background-color: #007bff;
    color: white;
    border: 1px solid #007bff;
    padding: 0.5em;
    cursor: pointer;
    margin-top: 1rem;
  }

  button:hover {
    background-color: #0056b3;
  }

  #errorMessage {
    color: red;
    margin-top: 10px;
    font-weight: bold;
  }

  /* Top Controls */
  #topControls {
    position: fixed;
    top: 10px;
    right: 30px;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: #eee;
    border: 1px solid #ccc;
    padding: 5px 8px;
    border-radius: 10px;
    font-size: 16px;
  }

  #topControls span {
    font-size: 1em;
    color: #333;
  }

  /* Dark Mode Toggle */
  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #888;
    transition: .4s;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: #2196F3;
    transition: .4s;
  }

  input:checked + .slider:before {
    transform: translateX(26px);
  }

  .slider.round { border-radius: 34px; }
  .slider.round:before { border-radius: 50%; }

  /* Text Size Controls */
  #textSizeControls {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  #textSizeControls .sizeButtons {
    display: inline-flex;
    gap: 5px;
  }

  /* Collapsible Sections */
  .collapsible-section {
    border: 1px solid #ccc;
    background: #fff;
    margin: 1em 0;
    border-radius: 10px;
    transition: background 0.4s ease, border-color 0.4s ease;
  }

  .collapsible-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5em;
    background: #f0f0f0;
    border-bottom: 1px solid #ccc;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  .collapsible-header h3 {
    margin: 0;
    font-size: 1em;
  }

  .collapsible-toggle {
    background-color: #007bff;
    border: none;
    color: #fff;
    padding: 0.3em 0.6em;
    cursor: pointer;
    font-size: 0.9em;
    border-radius: 4px;
  }

  .collapsible-content {
    overflow: hidden;
    max-height: 10000px;
    transition: max-height 0.5s ease-out, padding 0.5s ease;
    padding: 0.5em;
  }

  .collapsible-content.collapsed {
    max-height: 0;
    padding: 0;
  }

  /* Yes/No Questions Block */
  #n400Questions {
    border: 1px solid #ccc;
    border-radius: 10px;
    background: #fff;
    margin: 1em 0;
    transition: background 0.4s ease, border-color 0.4s ease;
  }

  #questionsHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5em;
    background: #f0f0f0;
    border-bottom: 1px solid #ccc;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
  }

  #questionsHeader h3 {
    margin: 0;
    font-size: 1em;
  }

  #toggleQuestions {
    background-color: #007bff;
    border: none;
    color: white;
    padding: 0.3em 0.6em;
    cursor: pointer;
    font-size: 0.9em;
    border-radius: 4px;
  }

  #questionsContent {
	  overflow-y: auto; /* Change from hidden to auto for vertical scroll */
	  max-height: 400px; /* Set a fixed height */
	  transition: max-height 0.5s ease-out, padding 0.5s ease;
	  padding: 0.5em;
  }
  
  #questionsHeader {
	  position: sticky;
	  top: 0;
	  z-index: 1;
	  background: #f0f0f0;
}

  .question {
    margin-bottom: 1em;
  }

  #questionsContent.collapsed {
    max-height: 0;
    padding: 0;
  }

  /* Dark Mode Styling */
  body.dark-mode {
    background: #1e1e2f;
    color: #e0e0e0;
  }

  body.dark-mode input,
  body.dark-mode select,
  body.dark-mode textarea {
    background: #2c2c3a !important;
    color: #e0e0e0 !important;
    border: 1px solid #3a3a55 !important;
  }

  body.dark-mode select {
    appearance: none;
    background: #333 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='currentColor' d='M2 0L0 2h4z'/%3E%3C/svg%3E") no-repeat right 10px center;
    background-size: 10px 12px;
    color: #e0e0e0;
  }

  body.dark-mode fieldset {
    background: #1e1e2f !important;
    border: 1px solid #1e1e2f !important;
  }

  body.dark-mode button {
    background-color: #2196F3 !important;
    border: 1px solid #2196F3 !important;
    color: #fff !important;
  }

  body.dark-mode #pdfPane { background: #333; }
  body.dark-mode #formPane { background: #222; }

  body.dark-mode #topControls {
    background: #444;
    border: 1px solid #666;
  }

  body.dark-mode #topControls span {
    color: #e0e0e0;
  }

  /* Collapsible (Dark Mode) */
  body.dark-mode .collapsible-section {
    background: #1e1e2f;
    border: 1px solid #1e1e2f;
  }

  body.dark-mode .collapsible-header {
    background: #1e1e2f;
    border-bottom: 1px solid #1e1e2f;
  }

  body.dark-mode .collapsible-toggle {
    background-color: #2196F3;
    border: 1px solid #2196F3;
    color: white;
  }

  /* Yes/No Block (Dark Mode) */
  body.dark-mode #n400Questions {
    background: #1e1e2f;
    border: 1px solid #1e1e2f;
  }

  body.dark-mode #questionsHeader {
    background: #1e1e2f;
    border-bottom: 1px solid #1e1e2f;
  }

  body.dark-mode #questionsContent {
    background: #1e1e2f;
    color: #e0e0e0;
  }

  body.dark-mode #toggleQuestions {
    background-color: #2196F3;
    border: 1px solid #2196F3;
    color: white;
  }
</style>

</head>
<body>
  <!-- Top Controls -->
  <div id="topControls">
    <div id="darkModeToggle">
      <label class="switch">
        <input type="checkbox" id="darkModeSwitch">
        <span class="slider round"></span>
      </label>
      <span>Dark Mode</span>
    </div>
    <div id="textSizeControls">
      <span>Text Size:</span>
      <div class="sizeButtons">
        <button type="button" id="decreaseTextSize">-</button>
        <button type="button" id="increaseTextSize">+</button>
      </div>
      <span id="textSizeDisplay">16</span>
    </div>
  </div>

  <!-- Main Interface Container -->
  <div class="container">
    <div id="pdfPane">
      <iframe id="pdfPreview"></iframe>
    </div>
    <div class="resizer" id="resizer"></div>
    <div id="formPane">
      <h2>USCIS PDF Filler</h2>
      <label>Select a Form:
        <select id="formSelect">
          <!--<option value="i912_conv.pdf">I-912</option>-->
          <option value="n400_conv.pdf" selected>N-400</option>
          <option value="n600_conv.pdf">AR-11</option>
        </select>
      </label>
      
	  
	  
		<div class="collapsible-section">
		  <div class="collapsible-header">
			<h3>Eligibility Information</h3>
			<button class="collapsible-toggle">Collapse</button>
		  </div>
		  <div class="collapsible-content">
			<label><input type="radio" name="reason" value="A"> A. General Provision</label>
			<label><input type="radio" name="reason" value="B"> B. Spouse of U.S. Citizen</label>
			<label><input type="radio" name="reason" value="C"> C. VAWA</label>
			<label><input type="radio" name="reason" value="D"> D. Spouse of U.S. Citizen Working Abroad</label>
			<div id="dDetails" style="display:none; padding-left: 1em;">
			  <label>Field Office Location: <input type="text" id="reasonDLocation" /></label>
			</div>
			<label><input type="radio" name="reason" value="E"> E. Military Service During Hostilities</label>
			<label><input type="radio" name="reason" value="F"> F. 1+ Year of Honorable Military Service</label>
			<label><input type="radio" name="reason" value="G"> G. Other Reason</label>
			<div id="gDetails" style="display:none; padding-left: 1em;">
			  <label>Please specify: <input type="text" id="reasonGText" /></label>
			</div>
		  </div>
		</div>

		
<div class="collapsible-section">
  <div class="collapsible-header">
    <h3>Information About You</h3>
    <button class="collapsible-toggle">Collapse</button>
  </div>
  <div class="collapsible-content">
    <fieldset>
      <legend>Name</legend>
      <label>First Name: <input type="text" id="firstName" /></label>
      <label>Middle Name: <input type="text" id="middleName" /></label>
      <label>Last Name: <input type="text" id="lastName" /></label>
    </fieldset>

    <fieldset id="legalNameChangeFieldset">
      <legend>Do you want to legally change your name?</legend>
      <label>
        <input type="radio" name="legalNameChange" value="no" checked>
        No
      </label>
      <label>
        <input type="radio" name="legalNameChange" value="yes">
        Yes
      </label>
    </fieldset>

    <div id="newLegalNameFields" style="display: none; margin-top: 1rem;">
      <fieldset>
        <legend>New Legal Name</legend>
        <label>New First Name: <input type="text" id="newFirstName" /></label>
        <label>New Middle Name: <input type="text" id="newMiddleName" /></label>
        <label>New Last Name: <input type="text" id="newLastName" /></label>
      </fieldset>
    </div>

    <fieldset>
      <legend>Date of Birth</legend>
      <label for="dob">Date of Birth: <input type="date" id="dob" /> </label>
    </fieldset>

    <fieldset>
      <label for="aNumber">A-Number:</label>
      <input type="text" id="aNumber" maxlength="11" placeholder="123-456-789">
      <label for="uscisAccount">USCIS Online Account Number:</label>
      <input type="text" id="uscisAccount" maxlength="12" placeholder="123456789012" />
	  <label for="sex"> Sex:</label>
	  <label><input type="radio" name="sex" value="male"> Male</label>
      <label><input type="radio" name="sex" value="female"> Female</label>
    </fieldset>

    <fieldset>
      <label for="permanentResidentDate">If you are a lawful permanent resident, give the date you became a permanent resident:</label>
      <input type="date" id="permanentResidentDate" />
    </fieldset>

    <fieldset>
      <label for="birthCountry">Country of Birth:</label>
      <input type="text" id="birthCountry" />

      <label for="citizenshipCountry">Country of Citizenship/Nationality:</label>
      <input type="text" id="citizenshipCountry" />
    </fieldset>

    <fieldset>
      <legend>Parental and Disability Information</legend>

      <p>10. Was your mother or father a U.S. citizen before your 18th birthday?</p>
      <label><input type="radio" name="q_10parent" value="yes"> Yes</label>
      <label><input type="radio" name="q_10parent" value="no"> No</label>

      <p>11. Do you have a physical or developmental disability or mental impairment that prevents you from demonstrating your knowledge and understanding of the English language or civics requirements for naturalization?</p>
      <label><input type="radio" name="q_11phys" value="yes"> Yes</label>
      <label><input type="radio" name="q_11phys" value="no"> No</label>
	  
    </fieldset>
	
	
    <fieldset>
	  <p>12a. Do you want the Social Security Administration (SSA) to issue you an original or replacement Social Security card and update your immigration status with the SSA if and when you are naturalized? </p>
      <label><input type="radio" name="q12_newcard" value="yes"> Yes</label>
      <label><input type="radio" name="q12_newcard" value="no"> No</label>
    </fieldset>
	

	

	<div id="ssaNewCardSection">
	<p>12c. Do you consent to the disclosure of your information from this application and USCIS systems 
       the SSA to assign you a SSN, issue you a new Social Security Card, and update your SSA immigration status?	</p>
      <label><input type="radio" name="q12_consent" value="yes"> Yes</label>
      <label><input type="radio" name="q12_consent" value="no"> No</label>
	</div>
	
    <fieldset>
      <legend>SSN</legend>
      <input type="tel" id="ssn" maxlength="11" placeholder="123-45-6789"/>
    </fieldset>
  </div>
</div>


<div class="collapsible-section">
  <div class="collapsible-header">
    <h3>Biographic Information</h3>
    <button class="collapsible-toggle">Collapse</button>
  </div>
  <div class="collapsible-content">
    <fieldset>

      <p>Ethnicity:</p>
      <label><input type="radio" name="ethnicity" value="hispanic"> Hispanic or Latino</label>
      <label><input type="radio" name="ethnicity" value="not_hispanic"> Not Hispanic or Latino</label>

      <p>Race (check all that apply):</p>
      <label><input type="checkbox" name="race" value="american_indian"> American Indian or Alaska Native</label>
      <label><input type="checkbox" name="race" value="asian"> Asian</label>
      <label><input type="checkbox" name="race" value="black"> Black or African American</label>
      <label><input type="checkbox" name="race" value="native_hawaiian"> Native Hawaiian or Other Pacific Islander</label>
      <label><input type="checkbox" name="race" value="white"> White</label>

      <p>Height:</p>
      <label>Feet: <input type="number" id="heightFeet" min="0" max="8"></label>
      <label>Inches: <input type="number" id="heightInches" min="0" max="11"></label>

      <p>Weight (in pounds):</p>
      <label><input type="number" id="weight" min="1" max="999"></label>

      <p>Eye Color:</p>
      <label><input type="radio" name="eyeColor" value="black"> Black</label>
      <label><input type="radio" name="eyeColor" value="blue"> Blue</label>
      <label><input type="radio" name="eyeColor" value="brown"> Brown</label>
      <label><input type="radio" name="eyeColor" value="gray"> Gray</label>
      <label><input type="radio" name="eyeColor" value="green"> Green</label>
      <label><input type="radio" name="eyeColor" value="hazel"> Hazel</label>
      <label><input type="radio" name="eyeColor" value="maroon"> Maroon</label>
      <label><input type="radio" name="eyeColor" value="pink"> Pink</label>
      <label><input type="radio" name="eyeColor" value="other"> Other</label>

      <p>Hair Color:</p>
      <label><input type="radio" name="hairColor" value="bald"> Bald</label>
      <label><input type="radio" name="hairColor" value="black"> Black</label>
      <label><input type="radio" name="hairColor" value="blond"> Blond</label>
      <label><input type="radio" name="hairColor" value="brown"> Brown</label>
      <label><input type="radio" name="hairColor" value="gray"> Gray</label>
      <label><input type="radio" name="hairColor" value="red"> Red</label>
      <label><input type="radio" name="hairColor" value="sandy"> Sandy</label>
      <label><input type="radio" name="hairColor" value="white"> White</label>
      <label><input type="radio" name="hairColor" value="other"> Other</label>
    </fieldset>
  </div>
</div>

	

		<span id="aNumberError" class="error-message"></span>
	<div class="collapsible-section">
  <div class="collapsible-header">
    <h3>Residence Information</h3>
    <button class="collapsible-toggle">Collapse</button>
  </div>
  <div class="collapsible-content">

    <!-- Current Mailing Address -->
    <fieldset>
      <legend>Current Mailing Address</legend>
      <label>Street: <input type="text" id="mailAddress" /></label>
      <label>City: <input type="text" id="mailCity" /></label>
      <label>Country:
        <select id="mailCountry">
          <option value="AF">Afghanistan (AF)</option>
          <option value="AL">Albania (AL)</option>
          <option value="DZ">Algeria (DZ)</option>
          <option value="AS">American Samoa (AS)</option>
          <option value="AD">Andorra (AD)</option>
          <option value="AO">Angola (AO)</option>
          <option value="AI">Anguilla (AI)</option>
          <option value="AQ">Antarctica (AQ)</option>
          <option value="AG">Antigua and Barbuda (AG)</option>
          <option value="AR">Argentina (AR)</option>
          <option value="AM">Armenia (AM)</option>
          <option value="AW">Aruba (AW)</option>
          <option value="AU">Australia (AU)</option>
          <option value="AT">Austria (AT)</option>
          <option value="AZ">Azerbaijan (AZ)</option>
          <option value="BS">Bahamas (BS)</option>
          <option value="BH">Bahrain (BH)</option>
          <option value="BD">Bangladesh (BD)</option>
          <option value="BB">Barbados (BB)</option>
          <option value="BY">Belarus (BY)</option>
          <option value="BE">Belgium (BE)</option>
          <option value="BZ">Belize (BZ)</option>
          <option value="BJ">Benin (BJ)</option>
          <option value="BM">Bermuda (BM)</option>
          <option value="BT">Bhutan (BT)</option>
          <option value="BO">Bolivia (BO)</option>
          <option value="BQ">Bonaire, Sint Eustatius and Saba (BQ)</option>
          <option value="BA">Bosnia and Herzegovina (BA)</option>
          <option value="BW">Botswana (BW)</option>
          <option value="BR">Brazil (BR)</option>
          <option value="CA">Canada (CA)</option>
          <option value="CN">China (CN)</option>
          <option value="CO">Colombia (CO)</option>
          <option value="DE">Germany (DE)</option>
          <option value="FR">France (FR)</option>
          <option value="IN">India (IN)</option>
          <option value="IT">Italy (IT)</option>
          <option value="JP">Japan (JP)</option>
          <option value="MX">Mexico (MX)</option>
          <option value="NG">Nigeria (NG)</option>
          <option value="RU">Russian Federation (RU)</option>
          <option value="SA">Saudi Arabia (SA)</option>
          <option value="ZA">South Africa (ZA)</option>
          <option value="KR">Korea (KR)</option>
          <option value="ES">Spain (ES)</option>
          <option value="SE">Sweden (SE)</option>
          <option value="CH">Switzerland (CH)</option>
          <option value="TR">Turkey (TR)</option>
          <option value="GB">United Kingdom (GB)</option>
          <option value="US" selected>United States of America (US)</option>
          <option value="ZW">Zimbabwe (ZW)</option>
          <option value="AX">Åland Islands (AX)</option>
        </select>
      </label>
      <label id="stateLabel">State/Province:
        <span id="mailStateContainer"></span>
      </label>
      <label id="zipLabel"></label>
      <span id="zipContainer"></span>
    </fieldset>

    <!-- Physical Address Confirmation -->
    <fieldset>
      <legend>Physical Address Confirmation</legend>
      <p>Is your current physical address also your current mailing address?</p>
      <label><input type="radio" name="sameAddress" value="yes"> Yes</label>
      <label><input type="radio" name="sameAddress" value="no"> No</label>
    </fieldset>

    <!-- Different Mailing Address (shown only if No) -->
    <fieldset id="differentMailingAddress" style="display: none;">
      <legend>Different Mailing Address</legend>
      <label>Street: <input type="text" id="newMailAddress" /></label>
      <label>City: <input type="text" id="newMailCity" /></label>
      <label>Country:
        <select id="newMailCountry">
			<option value="AF">Afghanistan (AF)</option>
			<option value="AL">Albania (AL)</option>
			<option value="DZ">Algeria (DZ)</option>
			<option value="AS">American Samoa (AS)</option>
			<option value="AD">Andorra (AD)</option>
			<option value="AO">Angola (AO)</option>
			<option value="AI">Anguilla (AI)</option>
			<option value="AQ">Antarctica (AQ)</option>
			<option value="AG">Antigua and Barbuda (AG)</option>
			<option value="AR">Argentina (AR)</option>
			<option value="AM">Armenia (AM)</option>
			<option value="AW">Aruba (AW)</option>
			<option value="AU">Australia (AU)</option>
			<option value="AT">Austria (AT)</option>
			<option value="AZ">Azerbaijan (AZ)</option>
			<option value="BS">Bahamas (BS)</option>
			<option value="BH">Bahrain (BH)</option>
			<option value="BD">Bangladesh (BD)</option>
			<option value="BB">Barbados (BB)</option>
			<option value="BY">Belarus (BY)</option>
			<option value="BE">Belgium (BE)</option>
			<option value="BZ">Belize (BZ)</option>
			<option value="BJ">Benin (BJ)</option>
			<option value="BM">Bermuda (BM)</option>
			<option value="BT">Bhutan (BT)</option>
			<option value="BO">Bolivia (BO)</option>
			<option value="BQ">Bonaire, Sint Eustatius and Saba (BQ)</option>
			<option value="BA">Bosnia and Herzegovina (BA)</option>
			<option value="BW">Botswana (BW)</option>
			<option value="BR">Brazil (BR)</option>
			<option value="CA">Canada (CA)</option>
			<option value="CN">China (CN)</option>
			<option value="CO">Colombia (CO)</option>
			<option value="DE">Germany (DE)</option>
			<option value="FR">France (FR)</option>
			<option value="IN">India (IN)</option>
			<option value="IT">Italy (IT)</option>
			<option value="JP">Japan (JP)</option>
			<option value="MX">Mexico (MX)</option>
			<option value="NG">Nigeria (NG)</option>
			<option value="RU">Russian Federation (RU)</option>
			<option value="SA">Saudi Arabia (SA)</option>
			<option value="ZA">South Africa (ZA)</option>
			<option value="KR">Korea (KR)</option>
			<option value="ES">Spain (ES)</option>
			<option value="SE">Sweden (SE)</option>
			<option value="CH">Switzerland (CH)</option>
			<option value="TR">Turkey (TR)</option>
			<option value="GB">United Kingdom (GB)</option>
			<option value="US" selected>United States of America (US)</option>
			<option value="ZW">Zimbabwe (ZW)</option>
			<option value="AX">Åland Islands (AX)</option>
		  </select>
			  </label>
			  <label id="newStateLabel">State/Province:
				<span id="newMailStateContainer"></span>
			  </label>
			  <label>ZIP Code: <input type="text" id="newMailZip" /></label>
			</fieldset>

		  </div>
		</div>

      <div class="collapsible-section">
  <div class="collapsible-header">
    <h3>Contact Info</h3>
    <button class="collapsible-toggle">Collapse</button>
  </div>
  <div class="collapsible-content">
    <fieldset>
      <legend>Contact Info</legend>
      <label>Phone: <input type="tel" id="phone" maxlength="12" placeholder="555-123-4567"/></label>
      <label>Email: <input type="email" id="email" /></label>
    </fieldset>
  </div>
</div>


	  

      
      <!-- Collapsible Yes/No Questions for N-400 -->
      <div id="n400Questions" style="display: none;">
        <div id="questionsHeader">
          <h3>Additional Information</h3>
          <button id="toggleQuestions">Collapse</button>
        </div>
        <div id="questionsContent">
          <!-- List all 50 questions exactly as provided, with no default selections -->
          <div class="question">
            <p>1. Have you EVER claimed to be a U.S. citizen (in writing or any other way)?</p>
            <label><input type="radio" name="q_1" value="yes"> Yes</label>
            <label><input type="radio" name="q_1" value="no"> No</label>
          </div>
          <div class="question">
            <p>2. Have you EVER registered to vote or voted in any Federal, state, or local election in the United States? If you lawfully voted only in a local election where aliens are eligible to vote, you may answer “No.”</p>
            <label><input type="radio" name="q_2" value="yes"> Yes</label>
            <label><input type="radio" name="q_2" value="no"> No</label>
          </div>
          <div class="question">
            <p>3. Do you currently owe any overdue Federal, state, or local taxes and/or have you called yourself a “nonresident alien” on your tax return?</p>
            <label><input type="radio" name="q_3" value="yes"> Yes</label>
            <label><input type="radio" name="q_3" value="no"> No</label>
          </div>
          <div class="question">
            <p>4. Since you became a lawful permanent resident, have you called yourself a “nonresident alien” on a Federal, state, or local tax return or decided not to file a tax return because you considered yourself to be a nonresident?</p>
            <label><input type="radio" name="q_4" value="yes"> Yes</label>
            <label><input type="radio" name="q_4" value="no"> No</label>
          </div>
          <div class="question">
            <p>5.a. Been a member of, involved in, or in any way associated with any Communist or totalitarian party anywhere in the world?</p>
            <label><input type="radio" name="q_5a" value="yes"> Yes</label>
            <label><input type="radio" name="q_5a" value="no"> No</label>
          </div>
          <div class="question">
            <p>5.b. Advocated (supported and promoted) any of the following, or been a member of, involved in, or in any way associated with any group anywhere in the world that advocated any of the following:<br></p>
            <p>- Opposition to all organized government;<br>
            - World Communism;<br>
            - The establishment in the United States of a totalitarian dictatorship;<br>
            - The overthrow by force or violence or other unconstitutional means of the Government of the United States or all forms of law;<br>
            - The unlawful assaulting or killing of any officer or officers of the Government of the United States or of any other organized government because of their official character;<br>
            - The unlawful damage, injury or destruction of property;<br>
            - Sabotage</p>
            <label><input type="radio" name="q_5b" value="yes"> Yes</label>
            <label><input type="radio" name="q_5b" value="no"> No</label>
          </div>
          <div class="question">
            <p>6a. Have you EVER used a weapon or explosive with intent to harm or cause property damage?</p>
            <label><input type="radio" name="q_6a" value="yes"> Yes</label>
            <label><input type="radio" name="q_6a" value="no"> No</label>
          </div>
          <div class="question">
            <p>6b. Have you EVER engaged in kidnapping, assassination, hijacking, or sabotage of transportation?</p>
            <label><input type="radio" name="q_6b" value="yes"> Yes</label>
            <label><input type="radio" name="q_6b" value="no"> No</label>
          </div>
          <div class="question">
            <p>6c. Have you EVER threatened, conspired, or incited others to commit any of the acts mentioned above? (6a &amp; 6b)</p>
            <label><input type="radio" name="q_6c" value="yes"> Yes</label>
            <label><input type="radio" name="q_6c" value="no"> No</label>
          </div>
          <div class="question">
            <p>7a. Have you EVER ordered, incited, called for, committed, assisted, helped with, or participated in any of the following: Torture?</p>
            <label><input type="radio" name="q_7a" value="yes"> Yes</label>
            <label><input type="radio" name="q_7a" value="no"> No</label>
          </div>
          <div class="question">
            <p>7b. Genocide?</p>
            <label><input type="radio" name="q_7b" value="yes"> Yes</label>
            <label><input type="radio" name="q_7b" value="no"> No</label>
          </div>
          <div class="question">
            <p>7c. Killing or trying to kill any person?</p>
            <label><input type="radio" name="q_7c" value="yes"> Yes</label>
            <label><input type="radio" name="q_7c" value="no"> No</label>
          </div>
          <div class="question">
            <p>7d. Intentionally and severely injuring or trying to injure any person?</p>
            <label><input type="radio" name="q_7d" value="yes"> Yes</label>
            <label><input type="radio" name="q_7d" value="no"> No</label>
          </div>
          <div class="question">
            <p>7e. Any kind of sexual contact or activity with any person who did not consent (did not agree) or was unable to consent (could not agree), or was being forced or threatened by you or by someone else?</p>
            <label><input type="radio" name="q_7e" value="yes"> Yes</label>
            <label><input type="radio" name="q_7e" value="no"> No</label>
          </div>
          <div class="question">
            <p>7f. Not letting someone practice his or her religion?</p>
            <label><input type="radio" name="q_7f" value="yes"> Yes</label>
            <label><input type="radio" name="q_7f" value="no"> No</label>
          </div>
          <div class="question">
            <p>7g. Causing harm or suffering to any person because of his or her race, religion, national origin, membership in a particular social group, or political opinion?</p>
            <label><input type="radio" name="q_7g" value="yes"> Yes</label>
            <label><input type="radio" name="q_7g" value="no"> No</label>
          </div>
          <div class="question">
            <p>8a. Have you EVER served in, been a member of, assisted (helped), or participated in any military or police unit?</p>
            <label><input type="radio" name="q_8a" value="yes"> Yes</label>
            <label><input type="radio" name="q_8a" value="no"> No</label>
          </div>
          <div class="question">
            <p>8b. Have you EVER served in, been a member of, assisted (helped), or participated in any armed group (a group that carries weapons), for example: paramilitary unit (a group of people who act like a military group but are not part of the official military), self-defense unit, vigilante unit, rebel group, or guerrilla group? If you answered “Yes” to Item Number 8.a. or Item Number 8.b., include the name of the country, the name of the military unit or armed group, your rank or position, and your dates of involvement in your explanation in Part 14. Additional Information</p>
            <label><input type="radio" name="q_8b" value="yes"> Yes</label>
            <label><input type="radio" name="q_8b" value="no"> No</label>
          </div>
          <div class="question">
            <p>9. Have you EVER worked, volunteered, or otherwise served in a place where people were detained (forced to stay), for example, a prison, jail, prison camp (a camp where prisoners of war or political prisoners are kept), detention facility, or labor camp, or have you EVER directed or participated in any other activity that involved detaining people?</p>
            <label><input type="radio" name="q_9" value="yes"> Yes</label>
            <label><input type="radio" name="q_9" value="no"> No</label>
          </div>
          <div class="question">
            <p>10a. Were you EVER a part of any group, or did you EVER help any group, unit, or organization that used a weapon against any person, or threatened to do so?</p>
            <label><input type="radio" name="q_10a" value="yes"> Yes</label>
            <label><input type="radio" name="q_10a" value="no"> No</label>
          </div>
          <div class="question">
            <p>10b. If you answered “Yes” to Item Number 10.a., when you were part of this group, or when you helped this group, did you ever use a weapon against another person?</p>
            <label><input type="radio" name="q_10b" value="yes"> Yes</label>
            <label><input type="radio" name="q_10b" value="no"> No</label>
          </div>
          <div class="question">
            <p>10c. If you answered “Yes” to Item Number 10.a., when you were part of this group, or when you helped this group, did you ever threaten another person that you would use a weapon against that person?</p>
            <label><input type="radio" name="q_10c" value="yes"> Yes</label>
            <label><input type="radio" name="q_10c" value="no"> No</label>
          </div>
          <div class="question">
            <p>11. Have you EVER sold, provided, or transported weapons, or assisted any person in selling, providing, or transporting weapons, which you knew or believed would be used against another person?</p>
            <label><input type="radio" name="q_11" value="yes"> Yes</label>
            <label><input type="radio" name="q_11" value="no"> No</label>
          </div>
          <div class="question">
            <p>12. Have you EVER received any weapons training, paramilitary training, or other military-type training?</p>
            <label><input type="radio" name="q_12" value="yes"> Yes</label>
            <label><input type="radio" name="q_12" value="no"> No</label>
          </div>
          <div class="question">
            <p>13. Have you EVER recruited (asked), enlisted (signed up), conscripted (required to join), or used any person under 15 years of age to serve in or help an armed group, or attempted or worked with others to do so?</p>
            <label><input type="radio" name="q_13" value="yes"> Yes</label>
            <label><input type="radio" name="q_13" value="no"> No</label>
          </div>
          <div class="question">
            <p>14. Have you EVER used any person under 15 years of age to take part in hostilities or attempted or worked with others to do so? This could include participating in combat or providing services related to combat (such as serving as a messenger or transporting supplies).</p>
            <label><input type="radio" name="q_14" value="yes"> Yes</label>
            <label><input type="radio" name="q_14" value="no"> No</label>
          </div>
          <div class="question">
            <p>15a. Have you EVER committed, agreed to commit, asked someone else to commit, helped commit, or tried to commit a crime or offense for which you were NOT arrested?</p>
            <label><input type="radio" name="q_15a" value="yes"> Yes</label>
            <label><input type="radio" name="q_15a" value="no"> No</label>
          </div>
          <div class="question">
            <p>15b. Have you EVER been arrested, cited, detained or confined by any law enforcement officer, military official (in the U.S. or elsewhere), or immigration official for any reason, or been charged with a crime or offense?</p>
            <label><input type="radio" name="q_15b" value="yes"> Yes</label>
            <label><input type="radio" name="q_15b" value="no"> No</label>
          </div>
          <div class="question">
            <p>16. If you received a suspended sentence, were placed on probation, or were paroled, have you completed your suspended sentence, probation, or parole?</p>
            <label><input type="radio" name="q_16" value="yes"> Yes</label>
            <label><input type="radio" name="q_16" value="no"> No</label>
          </div>
          <div class="question">
            <p>17a. Engaged in prostitution, attempted to procure or import prostitutes or persons for the purpose of prostitution, or received any proceeds or money from prostitution?</p>
            <label><input type="radio" name="q_17a" value="yes"> Yes</label>
            <label><input type="radio" name="q_17a" value="no"> No</label>
          </div>
          <div class="question">
            <p>17b. Manufactured, cultivated, produced, distributed, dispensed, sold, or smuggled (trafficked) any controlled substances, illegal drugs, narcotics, or drug paraphernalia in violation of any law or regulation of a U.S. state, the United States, or a foreign country?</p>
            <label><input type="radio" name="q_17b" value="yes"> Yes</label>
            <label><input type="radio" name="q_17b" value="no"> No</label>
          </div>
          <div class="question">
            <p>17c. Been married to more than one person at the same time?</p>
            <label><input type="radio" name="q_17c" value="yes"> Yes</label>
            <label><input type="radio" name="q_17c" value="no"> No</label>
          </div>
          <div class="question">
            <p>17d. Married someone in order to obtain an immigration benefit?</p>
            <label><input type="radio" name="q_17d" value="yes"> Yes</label>
            <label><input type="radio" name="q_17d" value="no"> No</label>
          </div>
          <div class="question">
            <p>17e. Helped anyone to enter, or try to enter, the United States illegally?</p>
            <label><input type="radio" name="q_17e" value="yes"> Yes</label>
            <label><input type="radio" name="q_17e" value="no"> No</label>
          </div>
          <div class="question">
            <p>17f. Gambled illegally or received income from illegal gambling?</p>
            <label><input type="radio" name="q_17f" value="yes"> Yes</label>
            <label><input type="radio" name="q_17f" value="no"> No</label>
          </div>
          <div class="question">
            <p>17g. Failed to support your dependents (pay child support) or to pay alimony (court-ordered financial support after divorce or separation)?</p>
            <label><input type="radio" name="q_17g" value="yes"> Yes</label>
            <label><input type="radio" name="q_17g" value="no"> No</label>
          </div>
          <div class="question">
            <p>17h. Made any misrepresentation to obtain any public benefit in the United States?</p>
            <label><input type="radio" name="q_17h" value="yes"> Yes</label>
            <label><input type="radio" name="q_17h" value="no"> No</label>
          </div>
          <div class="question">
            <p>18. Have you EVER given any U.S. Government officials any information or documentation that was false, fraudulent, or misleading?</p>
            <label><input type="radio" name="q_18" value="yes"> Yes</label>
            <label><input type="radio" name="q_18" value="no"> No</label>
          </div>
          <div class="question">
            <p>19. Have you EVER lied to any U.S. Government officials to gain entry or admission into the United States or to gain immigration benefits while in the United States?</p>
            <label><input type="radio" name="q_19" value="yes"> Yes</label>
            <label><input type="radio" name="q_19" value="no"> No</label>
          </div>
          <div class="question">
            <p>20. Have you EVER been placed in removal, rescission, or deportation proceedings?</p>
            <label><input type="radio" name="q_20" value="yes"> Yes</label>
            <label><input type="radio" name="q_20" value="no"> No</label>
          </div>
          <div class="question">
            <p>21. Have you EVER been removed or deported from the United States?</p>
            <label><input type="radio" name="q_21" value="yes"> Yes</label>
            <label><input type="radio" name="q_21" value="no"> No</label>
          </div>
          <div class="question">
            <p>22a. Are you a male who lived in the United States at any time between your 18th and 26th birthdays? (Do not select “Yes” if you were a lawful nonimmigrant for all of that time period.)</p>
            <label><input type="radio" name="q_22a" value="yes"> Yes</label>
            <label><input type="radio" name="q_22a" value="no"> No</label>
          </div>
          <div class="question">
            <p>22b. If you answered “Yes” to Item Number 22.a., did you register for the Selective Service?</p>
            <label><input type="radio" name="q_22b" value="yes"> Yes</label>
            <label><input type="radio" name="q_22b" value="no"> No</label>
          </div>
          <div class="question">
            <p>23. Have you EVER left the United States to avoid being drafted in the U.S. armed forces?</p>
            <label><input type="radio" name="q_23" value="yes"> Yes</label>
            <label><input type="radio" name="q_23" value="no"> No</label>
          </div>
          <div class="question">
            <p>24. Have you EVER applied for any kind of exemption from military service in the U.S. armed forces?</p>
            <label><input type="radio" name="q_24" value="yes"> Yes</label>
            <label><input type="radio" name="q_24" value="no"> No</label>
          </div>
          <div class="question">
            <p>25. Have you EVER served in the U.S. armed forces?</p>
            <label><input type="radio" name="q_25" value="yes"> Yes</label>
            <label><input type="radio" name="q_25" value="no"> No</label>
          </div>
          <div class="question">
            <p>26a. Are you currently a member of the U.S. armed forces?</p>
            <label><input type="radio" name="q_26a" value="yes"> Yes</label>
            <label><input type="radio" name="q_26a" value="no"> No</label>
          </div>
		  <div class="question">
            <p>26b. If you answered “Yes” to Item Number 26.a., are you scheduled to deploy outside the United States,
			including to a vessel, within the next 3 months?</p>
            <label><input type="radio" name="q_26b" value="yes"> Yes</label>
            <label><input type="radio" name="q_26b" value="no"> No</label>
          </div>
		  <div class="question">
            <p>26c. If you answered “Yes” to Item Number 26.a., are you currently stationed outside the United States?</p>
            <label><input type="radio" name="q_26c" value="yes"> Yes</label>
            <label><input type="radio" name="q_26c" value="no"> No</label>
          </div>
          
          <div class="question">
            <p>26d. If you answered “No” to Item Number 26.a., are you a former U.S. military service member who is currently residing outside of the U.S.?</p>
            <label><input type="radio" name="q_26d" value="yes"> Yes</label>
            <label><input type="radio" name="q_26d" value="no"> No</label>
          </div>
          <div class="question">
            <p>27. Have you EVER been court-martialed or have you received a discharge characterized as other than honorable, bad conduct, or dishonorable, while in the U.S. armed forces?</p>
            <label><input type="radio" name="q_27" value="yes"> Yes</label>
            <label><input type="radio" name="q_27" value="no"> No</label>
          </div>
          <div class="question">
            <p>28. Have you EVER been discharged from training or service in the U.S. armed forces because you were an alien?</p>
            <label><input type="radio" name="q_28" value="yes"> Yes</label>
            <label><input type="radio" name="q_28" value="no"> No</label>
          </div>
          <div class="question">
            <p>29. Have you EVER deserted from the U.S. armed forces?</p>
            <label><input type="radio" name="q_29" value="yes"> Yes</label>
            <label><input type="radio" name="q_29" value="no"> No</label>
          </div>
          <div class="question">
            <p>30a. Do you now have, or did you EVER have, a hereditary title or an order of nobility in any foreign country?</p>
            <label><input type="radio" name="q_30a" value="yes"> Yes</label>
            <label><input type="radio" name="q_30a" value="no"> No</label>
          </div>
          <div class="question">
            <p>30b. If you answered "Yes" to 30a, are you willing to give up any inherited titles or orders of nobility that you have in a foreign country at your naturalization ceremony?</p>
            <label><input type="radio" name="q_30b" value="yes"> Yes</label>
            <label><input type="radio" name="q_30b" value="no"> No</label>
          </div>
          <div class="question">
            <p>31. Do you support the Constitution and form of Government of the United States?</p>
            <label><input type="radio" name="q_31" value="yes"> Yes</label>
            <label><input type="radio" name="q_31" value="no"> No</label>
          </div>
          <div class="question">
            <p>32. Do you understand the full Oath of Allegiance to the United States?</p>
            <label><input type="radio" name="q_32" value="yes"> Yes</label>
            <label><input type="radio" name="q_32" value="no"> No</label>
          </div>
          <div class="question">
            <p>33. Are you unable to take the Oath of Allegiance because of a physical or developmental disability or mental impairment? If you answer “Yes,” skip Item Numbers 34. - 37. and see the Legal Guardian, Surrogate, or Designated Representative section in the Instructions</p>
            <label><input type="radio" name="q_33" value="yes"> Yes</label>
            <label><input type="radio" name="q_33" value="no"> No</label>
          </div>
          <div class="question">
            <p>34. Are you willing to take the full Oath of Allegiance to the United States?</p>
            <label><input type="radio" name="q_34" value="yes"> Yes</label>
            <label><input type="radio" name="q_34" value="no"> No</label>
          </div>
          <div class="question">
            <p>35. If the law requires it, are you willing to bear arms (carry weapons) on behalf of the United States?</p>
            <label><input type="radio" name="q_35" value="yes"> Yes</label>
            <label><input type="radio" name="q_35" value="no"> No</label>
          </div>
          <div class="question">
            <p>36. If the law requires it, are you willing to perform noncombatant services (do something that does not include fighting in a war) in the U.S. armed forces?</p>
            <label><input type="radio" name="q_36" value="yes"> Yes</label>
            <label><input type="radio" name="q_36" value="no"> No</label>
          </div>
          <div class="question">
            <p>37. If the law requires it, are you willing to perform work of national importance under civilian direction (do non-military work that the U.S. Government says is important to the country)?</p>
            <label><input type="radio" name="q_37" value="yes"> Yes</label>
            <label><input type="radio" name="q_37" value="no"> No</label>
          </div>
        </div>
      </div>
      
      <button type="button" id="updatePreviewBtn">Update Preview</button>
      <div id="errorMessage"></div>
      <form id="uscis-form">
<script>
document.getElementById("uscis-form").addEventListener("submit", function(e) {
  e.preventDefault();

  if (!latestFilledPdfBytes) {
    alert("Please click 'Update Preview' before downloading.");
    return;
  }

  const blob = new Blob([latestFilledPdfBytes], { type: "application/pdf" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "filled_form.pdf";
  a.click();
  URL.revokeObjectURL(url);
});

</script>
        <button type="submit">Download Filled PDF</button>
      </form>
    </div>
  </div>
  
  <script>
  
	let latestFilledPdfBytes = null;

    // Toggle collapse/expand for yes/no questions section
	const toggleBtn = document.getElementById("toggleQuestions");
	const questionsContent = document.getElementById("questionsContent");

	toggleBtn.addEventListener("click", () => {
		const collapsed = questionsContent.classList.toggle("collapsed");
		toggleBtn.innerText = collapsed ? "Expand" : "Collapse";
	});

    
    // Show/hide yes/no questions based on the selected form
    const n400Questions = document.getElementById("n400Questions");
    const formSelect = document.getElementById("formSelect");
    formSelect.addEventListener("change", function() {
      n400Questions.style.display = (this.value === "n400_conv.pdf") ? "block" : "none";
    });
    if(formSelect.value === "n400_conv.pdf"){
      n400Questions.style.display = "block";
    } else {
      n400Questions.style.display = "none";
    }
    
    // Dark mode toggle
    const darkModeSwitch = document.getElementById("darkModeSwitch");
    darkModeSwitch.addEventListener("change", function() {
      if (this.checked) {
        document.body.classList.add("dark-mode");
      } else {
        document.body.classList.remove("dark-mode");
      }
    });
	
	

	
	document.querySelectorAll('input[name="legalNameChange"]').forEach((elem) => {
	  elem.addEventListener("change", function() {
		const newFields = document.getElementById("newLegalNameFields");
		newFields.style.display = this.value === "yes" ? "block" : "none";
	  });
	});
	

	
    
    // Text size controls
    const decreaseTextSizeButton = document.getElementById("decreaseTextSize");
    const increaseTextSizeButton = document.getElementById("increaseTextSize");
    const textSizeDisplay = document.getElementById("textSizeDisplay");
    let currentFontSize = 16;
    decreaseTextSizeButton.addEventListener("click", () => {
      if (currentFontSize > 10) {
        currentFontSize -= 1;
        textSizeDisplay.innerText = currentFontSize;
        document.querySelector("#formPane").style.fontSize = currentFontSize + "px";
        document.querySelector("#pdfPane").style.fontSize = currentFontSize + "px";
      }
    });
    increaseTextSizeButton.addEventListener("click", () => {
      if (currentFontSize < 30) {
        currentFontSize += 1;
        textSizeDisplay.innerText = currentFontSize;
        document.querySelector("#formPane").style.fontSize = currentFontSize + "px";
        document.querySelector("#pdfPane").style.fontSize = currentFontSize + "px";
      }
    });
    
    const pdfPreview = document.getElementById("pdfPreview");
    const updatePreviewBtn = document.getElementById("updatePreviewBtn");
    const resizer = document.getElementById("resizer");
    const pdfPane = document.getElementById("pdfPane");
    let originalPdfBytes = null;
    let font = null;
    let validateOnUpdate = false;
    
    /* Field coordinate mappings.
       For "n400_conv.pdf", each yes/no question is assigned its own overlay coordinates.
       (These dummy coordinates decrement by 10 in y for each question; adjust as needed.)
    */
    const fieldCoords = {
      "i912_conv.pdf": {
        firstName:  { page: 0, x: 280, y: 178 },
        middleName: { page: 0, x: 445, y: 178 },
        lastName:   { page: 0, x: 57, y: 178 },
		dob:        { page: 0, x: 65, y: 120 },
        ssn:        { page: 1, x: 235, y: 705 },
        phone:      { page: 4, x: 57, y: 465 },
        email:      { page: 4, x: 57, y: 430 },
        mailAddress:{ page: 1, x: 50, y: 610 },
        mailCity:   { page: 1, x: 50, y: 595 },
        mailCountry:{ page: 1, x: 50, y: 570 },
        mailState:  { page: 1, x: 200, y: 595 },
        mailProvince:{ page: 1, x: 200, y: 575 },
        mailZip:    { page: 1, x: 350, y: 595 },
        mailPostal: { page: 1, x: 350, y: 595 }
		
      },
      "n400_conv.pdf": {
        firstName:  { page: 0, x: 280, y: 136 },//good
        middleName: { page: 0, x: 445, y: 136 },//good
        lastName:   { page: 0, x: 63, y: 136 },//good
		legalNameX: { page: 1, x: 278, y: 620 },         
	    newFirstName: { page: 1, x: 278, y: 615 },         
	    newMiddleName:{ page: 1, x: 445, y: 615 },         
	    newLastName: { page: 1, x: 62, y: 615 },
		dob:        { page: 1, x: 65, y: 543 },//good
		birthCountry:       { page: 1, x: 62, y: 443 },
		citizenshipCountry: { page: 1, x: 62, y: 406 },
		"q_10parent": { yes: { page: 1, x: 498, y: 356 }, no: { page: 1, x: 542, y: 356 } },
		"q_11phys": { yes: { page: 1, x: 498, y: 320 }, no: { page: 1, x: 542, y: 320 } },
		ethnicity: {
			 hispanic:     { page: 2, x: 62, y: 659 },
			 not_hispanic: { page: 2, x: 170, y: 659 }
		},
		race: {
		  american_indian:  { page: 2, x: 62, y: 623 },
		  asian:            { page: 2, x: 170, y: 623 },
		  black:            { page: 2, x: 225, y: 623 },
		  native_hawaiian:  { page: 2, x: 327, y: 623 },
		  white:            { page: 2, x: 447, y: 623 }
		},
		heightFeet:         { page: 2, x: 124, y: 593 },
		heightInches:       { page: 2, x: 216, y: 593 },
		weight:             { page: 2, x: 380, y: 593 }, 
		eyeColor: {
		  black:            { page: 2, x: 62, y: 557 },
		  blue:             { page: 2, x: 128, y: 557 },
		  brown:            { page: 2, x: 176, y: 557 },
		  gray:             { page: 2, x: 230, y: 557 },
		  green:            { page: 2, x: 285, y: 557 },
		  hazel:            { page: 2, x: 338, y: 557 },
		  maroon:           { page: 2, x: 387, y: 557 },
		  pink:             { page: 2, x: 446, y: 557 },
		  other:            { page: 2, x: 495, y: 557 }
		},
		hairColor: {
		  bald:             { page: 2, x: 62, y: 521 },
		  black:            { page: 2, x: 128, y: 521 },
		  blond:            { page: 2, x: 176, y: 521 },
		  brown:            { page: 2, x: 230, y: 521 },
		  gray:             { page: 2, x: 285, y: 521 },
		  red:              { page: 2, x: 338, y: 521 },
		  sandy:            { page: 2, x: 387, y: 521 },
		  white:            { page: 2, x: 446, y: 521 },
		  other:            { page: 2, x: 495, y: 521 }
		},


		permanentResidentDate: { page: 1, x: 241, y: 477 },  
        ssn:        { page: 1, x: 290, y: 135 },//good
		q12_newcard: {
		yes: { page: 1, x: 62, y: 176 },  
		no:  { page: 1, x: 62, y: 158 }
		},
		
		q12_consent: {
		yes: { page: 1, x: 499, y: 116 },  
		no:  { page: 1, x: 541, y: 116 }
		},

		uscisAccount: { page: 1, x: 74, y: 583 },
		sex: {
		 male:   { page: 1, x: 283, y: 581 }, 
		 female: { page: 1, x: 331, y: 582 }  
		},
		aNumberMulti: [
				    { page: 0, x: 458, y: 492 },  
				    { page: 1, x: 458, y: 725 },  
				    { page: 2, x: 458, y: 725 },
					{ page: 3, x: 458, y: 725 }, 
					{ page: 4, x: 458, y: 725 }, 
					{ page: 5, x: 458, y: 725 }, 
					{ page: 6, x: 458, y: 725 }, 
					{ page: 7, x: 458, y: 725 },
					{ page: 8, x: 458, y: 725 }, 
					{ page: 9, x: 458, y: 725 }, 
					{ page: 10, x: 458, y: 725 }, 
					{ page: 11, x: 458, y: 725 }, 
					{ page: 12, x: 458, y: 725 }, 
					{ page: 13, x: 458, y: 725 }, 					
				],
        phone:      { page: 10, x: 67, y: 378 },//good
        email:      { page: 10, x: 67, y: 341 },//good
		
        mailAddress:{ page: 2, x: 67, y: 317 },//good
        mailCity:   { page: 2, x: 67, y: 280 },//good
        mailCountry:{ page: 2, x: 356, y: 243 },//good
        mailState:  { page: 2, x: 447, y: 280 },//good
        mailProvince:{ page: 2, x: 64, y: 243 },//good
        mailZip:    { page: 2, x: 520, y: 280 },//good
        mailPostal: { page: 2, x: 225, y: 243 },//good
		
		sameAddress: {
		  yes: { page: 2, x: 100, y: 360 }, 
		  no:  { page: 2, x: 160, y: 360 }
		},
		
		newMailAddress: { page: 3, x: 63, y: 635 },
		newMailCity:    { page: 3, x: 63, y: 597 },
		newMailState:   { page: 3, x: 447, y: 559 },
		newMailZip:     { page: 3, x: 520, y: 370 },
		newMailCountry: { page: 3, x: 356, y: 340 },  
		newMailProvince: { page: 3, x: 63, y: 559 },  
		newMailPostal:  { page: 3, x: 225, y: 340 },

		
		//PAGE 6 GOOD
        firstName:  { page: 0, x: 280, y: 136 },//good
        middleName: { page: 0, x: 445, y: 136 },//good
        lastName:   { page: 0, x: 63, y: 136 },//good
		legalNameX: { page: 1, x: 100, y: 450 },         
	    newFirstName: { page: 1, x: 278, y: 615 },         
	    newMiddleName:{ page: 1, x: 445, y: 615 },         
	    newLastName: { page: 1, x: 62, y: 615 },
		dob:        { page: 1, x: 65, y: 543 },//good
        ssn:        { page: 1, x: 290, y: 135 },//good
		aNumber:    { page: 0, x: 458, y: 492 },//good
        phone:      { page: 10, x: 67, y: 378 },//good
        email:      { page: 10, x: 67, y: 341 },//good

		
		//PAGE 6 GOOD
        "q_1": { yes: { page: 5, x: 500, y: 374 }, no: { page: 5, x: 542, y: 374 } },
        "q_2": { yes: { page: 5, x: 500, y: 356 }, no: { page: 5, x: 542, y: 356 } },
        "q_3": { yes: { page: 5, x: 500, y: 314 }, no: { page: 5, x: 542, y: 314 } },
        "q_4": { yes: { page: 5, x: 500, y: 295 }, no: { page: 5, x: 542, y: 295 } },
        "q_5a": { yes: { page: 5, x: 500, y: 235 }, no: { page: 5, x: 542, y: 235 } },
        "q_5b": { yes: { page: 5, x: 500, y: 206 }, no: { page: 5, x: 542, y: 206 } },
		//PAGE 7
        "q_6a": { yes: { page: 6, x: 500, y: 674 }, no: { page: 6, x: 542, y: 674 } },
        "q_6b": { yes: { page: 6, x: 500, y: 655 }, no: { page: 6, x: 542, y: 655 } },
        "q_6c": { yes: { page: 6, x: 500, y: 625 }, no: { page: 6, x: 542, y: 625 } },
        "q_7a": { yes: { page: 6, x: 500, y: 578 }, no: { page: 6, x: 542, y: 578 } },
        "q_7b": { yes: { page: 6, x: 500, y: 560 }, no: { page: 6, x: 542, y: 560 } },
        "q_7c": { yes: { page: 6, x: 500, y: 542 }, no: { page: 6, x: 542, y: 542 } },
        "q_7d": { yes: { page: 6, x: 500, y: 524 }, no: { page: 6, x: 542, y: 524 } },
        "q_7e": { yes: { page: 6, x: 500, y: 506 }, no: { page: 6, x: 542, y: 506 } },
        "q_7f": { yes: { page: 6, x: 500, y: 476 }, no: { page: 6, x: 542, y: 476 } },
        "q_7g": { yes: { page: 6, x: 500, y: 457 }, no: { page: 6, x: 542, y: 457 } },
        "q_8a": { yes: { page: 6, x: 500, y: 427 }, no: { page: 6, x: 542, y: 427 } },
        "q_8b": { yes: { page: 6, x: 500, y: 397 }, no: { page: 6, x: 542, y: 397 } },
        "q_9": { yes: { page: 6, x: 500, y: 301 }, no: { page: 6, x: 542, y: 301 } },
        "q_10a": { yes: { page: 6, x: 500, y: 247 }, no: { page: 6, x: 542, y: 247 } },
        "q_10b": { yes: { page: 6, x: 500, y: 217 }, no: { page: 6, x: 542, y: 217 } },
        "q_10c": { yes: { page: 6, x: 500, y: 187  }, no: { page: 6, x: 542, y: 187  } },
        "q_11": { yes: { page: 6, x: 500, y: 157  }, no: { page: 6, x: 542, y: 157  } },
        "q_12": { yes: { page: 6, x: 500, y: 128  }, no: { page: 6, x: 542, y: 128  } },
        "q_13": { yes: { page: 6, x: 500, y: 109  }, no: { page: 6, x: 542, y: 109  } },
        "q_14": { yes: { page: 6, x: 500, y: 67  }, no: { page: 6, x: 542, y: 67  } },
		//PAGE 8//good
        "q_15a": { yes: { page: 7, x: 500, y: 455  }, no: { page: 7, x: 542, y: 455  } },
        "q_15b": { yes: { page: 7, x: 500, y: 425  }, no: { page: 7, x: 542, y: 425  } },
        "q_16": { yes: { page: 7, x: 500, y: 133  }, no: { page: 7, x: 542, y: 133  } },
		//PAGE 9//good
        "q_17a": { yes: { page: 8, x: 500, y: 686  }, no: { page: 8, x: 542, y: 686  } },
        "q_17b": { yes: { page: 8, x: 500, y: 655   }, no: { page: 8, x: 542, y: 655   } },
        "q_17c": { yes: { page: 8, x: 500, y: 614 }, no: { page: 8, x: 542, y: 614 } },
        "q_17d": { yes: { page: 8, x: 500, y: 596 }, no: { page: 8, x: 542, y: -20 } },
        "q_17e": { yes: { page: 8, x: 500, y: 578 }, no: { page: 8, x: 542, y: 596 } },
        "q_17f": { yes: { page: 8, x: 500, y: 560 }, no: { page: 8, x: 542, y: 560 } },
        "q_17g": { yes: { page: 8, x: 500, y: 541 }, no: { page: 8, x: 542, y: 541 } },
        "q_17h": { yes: { page: 8, x: 500, y: 512 }, no: { page: 8, x: 542, y: 512 } },
        "q_18": { yes: { page: 8, x: 500, y: 494 }, no: { page: 8, x: 542, y: 494 } },
        "q_19": { yes: { page: 8, x: 500, y: 463 }, no: { page: 8, x: 542, y: 463 } },
        "q_20": { yes: { page: 8, x: 500, y: 392 }, no: { page: 8, x: 542, y: 392 } },
        "q_21": { yes: { page: 8, x: 500, y: 374 }, no: { page: 8, x: 542, y: 374 } },
        "q_22a": { yes: { page: 8, x: 500, y: 324 }, no: { page: 8, x: 542, y: 324 } },
        "q_22b": { yes: { page: 8, x: 500, y: 297 }, no: { page: 8, x: 542, y: 297 } },
        "q_23": { yes: { page: 8, x: 500, y: 176 }, no: { page: 8, x: 542, y: 176 } },
        "q_24": { yes: { page: 8, x: 500, y: 158 }, no: { page: 8, x: 542, y: 158 } },
        "q_25": { yes: { page: 8, x: 500, y: 140 }, no: { page: 8, x: 542, y: 140 } },
		//PAGE 10
        "q_26a": { yes: { page: 9, x: 500, y: 686 }, no: { page: 9, x: 542, y: 686 } },
		"q_26b": { yes: { page: 9, x: 500, y: 667 }, no: { page: 9, x: 542, y: 667 } },
        "q_26c": { yes: { page: 9, x: 500, y: 614 }, no: { page: 9, x: 542, y: 614 } },
        "q_26d": { yes: { page: 9, x: 500, y: 595 }, no: { page: 9, x: 542, y: 595 } },
        "q_27": { yes: { page: 9, x: 500, y: 547 }, no: { page: 9, x: 542, y: 547 } },
        "q_28": { yes: { page: 9, x: 500, y: 518 }, no: { page: 9, x: 542, y: 518 } },
        "q_29": { yes: { page: 9, x: 500, y: 488 }, no: { page: 9, x: 542, y: 488 } },
        "q_30a": { yes: { page: 9, x: 391, y: 440 }, no: { page: 9, x: 433, y: 440 } },
        "q_30b": { yes: { page: 9, x: 500, y: 407 }, no: { page: 9, x: 542, y: 407 } },
        "q_31": { yes: { page: 9, x: 500, y: 320 }, no: { page: 9, x: 542, y: 320 } },
        "q_32": { yes: { page: 9, x: 500, y: 302 }, no: { page: 9, x: 542, y: 302 } },
        "q_33": { yes: { page: 9, x: 500, y: 281}, no: { page: 9, x: 542, y: 281 } },
        "q_34": { yes: { page: 9, x: 500, y: 242 }, no: { page: 9, x: 542, y: 242 } },
        "q_35": { yes: { page: 9, x: 500, y: 224 }, no: { page: 9, x: 542, y: 224} },
        "q_36": { yes: { page: 9, x: 500, y: 206 }, no: { page: 9, x: 542, y: 206 } },
        "q_37": { yes: { page: 9, x: 500, y: 176 }, no: { page: 9, x: 542, y: 176 } },
		reason: {
			A: { page: 0, x: 86, y: 447 },
			B: { page: 0, x: 86, y: 428 },
			C: { page: 0, x: 86, y: 410 },
			D: { page: 0, x: 86, y: 380 },
			E: { page: 0, x: 86, y: 290 },
			F: { page: 0, x: 86, y: 260 },
			G: { page: 0, x: 86, y: 227 }
		},
		reasonDLocation: { page: 0, x: 103, y: 310 },
		reasonGText:     { page: 0, x: 290, y: 227 }

    },
      
      "n600_conv.pdf": {
        firstName:  { page: 0, x: 80, y: 720 },
        middleName: { page: 0, x: 170, y: 720 },
        lastName:   { page: 0, x: 320, y: 720 },
		dob:        { page: 0, x: 65, y: 120 },
        ssn:        { page: 0, x: 80, y: 690 },
        phone:      { page: 0, x: 80, y: 670 },
        email:      { page: 0, x: 80, y: 655 },
        mailAddress:{ page: 1, x: 80, y: 640 },
        mailCity:   { page: 1, x: 80, y: 625 },
        mailCountry:{ page: 1, x: 80, y: 610 },
        mailState:  { page: 1, x: 230, y: 625 },
        mailProvince:{ page: 1, x: 230, y: 615 },
        mailZip:    { page: 1, x: 380, y: 625 },
        mailPostal: { page: 1, x: 380, y: 625 }
      }
	  }

    
    // Resizer code
    let isResizing = false;
    const resizeOverlay = document.createElement('div');
    resizeOverlay.style.display = 'none';
    resizeOverlay.style.position = 'fixed';
    resizeOverlay.style.top = 0;
    resizeOverlay.style.left = 0;
    resizeOverlay.style.right = 0;
    resizeOverlay.style.bottom = 0;
    resizeOverlay.style.cursor = 'ew-resize';
    resizeOverlay.style.zIndex = 9999;
    document.body.appendChild(resizeOverlay);
    resizer.addEventListener('mousedown', (e) => {
      isResizing = true;
      resizeOverlay.style.display = 'block';
      document.body.style.cursor = 'ew-resize';
      e.preventDefault();
    });
    document.addEventListener('mousemove', (e) => {
      if (!isResizing) return;
      const newWidth = e.clientX;
      if (newWidth > 250 && newWidth < window.innerWidth - 250) {
        pdfPane.style.width = `${newWidth}px`;
      }
    });
    document.addEventListener('mouseup', () => {
      if (isResizing) {
        isResizing = false;
        resizeOverlay.style.display = 'none';
        document.body.style.cursor = 'default';
      }
    });
    
    function maskSSN(value) {
      let digits = value.replace(/\D/g, '').substring(0, 9);
      if (digits.length > 5) {
        return digits.slice(0, 3) + "-" + digits.slice(3, 5) + "-" + digits.slice(5);
      } else if (digits.length > 3) {
        return digits.slice(0, 3) + "-" + digits.slice(3);
      } else {
        return digits;
      }
    }
    function maskPhone(value) {
      let digits = value.replace(/\D/g, '').substring(0, 10);
      if (digits.length > 6) {
        return digits.slice(0, 3) + "-" + digits.slice(3, 6) + "-" + digits.slice(6);
      } else if (digits.length > 3) {
        return digits.slice(0, 3) + "-" + digits.slice(3);
      } else {
        return digits;
      }
    }
    document.getElementById("ssn").addEventListener("input", function() {
      this.value = maskSSN(this.value);
    });
	
	document.getElementById("aNumber").addEventListener("input", function () {
	  let raw = this.value.replace(/\D/g, ""); // Remove non-digits
	  if (raw.length > 9) raw = raw.slice(0, 9);

	  let formatted = raw.replace(/^(\d{3})(\d{0,3})(\d{0,3})$/, function (_, a, b, c) {
		let result = a;
		if (b) result += "-" + b;
		if (c) result += "-" + c;
		return result;
	  });

	  this.value = formatted;
	});
	
    document.getElementById("phone").addEventListener("input", function() {
      this.value = maskPhone(this.value);
    });
    
	
	
	function updateStateField() {
		const country = document.getElementById("mailCountry").value;
		const stateContainer = document.getElementById("mailStateContainer");
		stateContainer.innerHTML = "";

		if (country === "US") {
			const stateSelect = document.createElement("select");
			stateSelect.id = "mailState";
			const states = ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware",
			"Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky",
			"Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi",
			"Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico",
			"New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
			"Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont",
			"Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"];
		stateSelect.innerHTML = states.map(s => `<option value="${s}">${s}</option>`).join("");
		stateContainer.appendChild(stateSelect);
		} else {
		const provinceField = document.createElement("input");
		provinceField.type = "text";
		provinceField.id = "mailProvince";
		stateContainer.appendChild(provinceField);
		}
	}

	document.getElementById("mailCountry").addEventListener("change", () => {
		updateStateField();
		updateZipField(); // Keep ZIP/Postal sync
	});

	updateStateField(); // Run once on load
	updateZipField();


    function updateZipField() {
      const country = document.getElementById("mailCountry").value;
      const zipContainer = document.getElementById("zipContainer");
      const zipLabel = document.getElementById("zipLabel");
      while (zipContainer.firstChild) {
        zipContainer.removeChild(zipContainer.firstChild);
      }
      if (country === "US") {
        zipLabel.innerText = "ZIP Code:";
        let zipField = document.createElement("input");
        zipField.type = "tel";
        zipField.id = "mailZip";
        zipField.maxLength = "5";
        zipField.placeholder = "12345";
        zipContainer.appendChild(zipField);
      } else {
        zipLabel.innerText = "Postal Code:";
        let postalField = document.createElement("input");
        postalField.type = "tel";
        postalField.id = "mailPostal";
        postalField.maxLength = "5";
        postalField.placeholder = "12345";
        zipContainer.appendChild(postalField);
      }
    }
    
    function validateInputs() {
      const ssnInput = document.getElementById("ssn").value;
      const phoneInput = document.getElementById("phone").value;
      const country = document.getElementById("mailCountry").value;
      let zipDigits = "";
      if (country === "US") {
        zipDigits = document.getElementById("mailZip").value.replace(/\D/g, '');
      } else {
        zipDigits = document.getElementById("mailPostal").value.replace(/\D/g, '');
      }
      const ssnDigits = ssnInput.replace(/\D/g, '');
      const phoneDigits = phoneInput.replace(/\D/g, '');
      let errors = [];
      if (ssnDigits.length !== 9) {
        errors.push("SSN must contain exactly 9 digits.");
      }
      if (phoneDigits.length !== 10) {
        errors.push("Phone number must contain exactly 10 digits.");
      }
	  
	  if (document.getElementById("aNumber")) {
		  const el = document.getElementById("aNumber");
		  const err = document.getElementById("aNumberError");
		  const raw = el.value.replace(/\D/g, "");
		  if (raw.length !== 9) {
			err.textContent = "A-Number must be exactly 9 digits.";
			isValid = false;
		  } else {
			err.textContent = "";
		  }
		}

      if (zipDigits.length !== 5) {
        if (country === "US") {
          errors.push("ZIP must contain exactly 5 digits.");
        } else {
          errors.push("Postal Code must contain exactly 5 digits.");
        }
      }
	  
	  const dobValue = document.getElementById("dob").value;
		if (dobValue) {
			const today = new Date().toISOString().split("T")[0];
            if (dobValue > today) {
				errors.push("Date of Birth cannot be in the future.");
			}
		}
	  
	  
      const errorMessageDiv = document.getElementById("errorMessage");
      if (errors.length > 0) {
        errorMessageDiv.innerText = errors.join(" ");
        return false;
      } else {
        errorMessageDiv.innerText = "";
        return true;
      }
    }
    
    function formatSSN(ssn) {
      let digits = ssn.replace(/\D/g, '');
      if (digits.length === 9) {
        return digits.slice(0, 3) + "-" + digits.slice(3, 5) + "-" + digits.slice(5);
      }
      return ssn;
    }
    function formatPhone(phone) {
      let digits = phone.replace(/\D/g, '');
      if (digits.length === 10) {
        return digits.slice(0, 3) + "-" + digits.slice(3, 6) + "-" + digits.slice(6);
      }
      return phone;
    }
    
    async function loadPDF(filename) {
      const res = await fetch(filename);
      originalPdfBytes = await res.arrayBuffer();
      await updatePreview();
    }
    
    async function updatePreview() {
      if (!originalPdfBytes) return;
      if (validateOnUpdate && !validateInputs()) return;
      const pdfDoc = await PDFLib.PDFDocument.load(originalPdfBytes, { ignoreEncryption: true });
      const pages = pdfDoc.getPages();
      if (!font) font = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
      const currentForm = formSelect.value;
      const coords = fieldCoords[currentForm];
	  
			  // === Biographic Information Overlay ===

		// Ethnicity (radio - like yes/no)
		const ethnicityInput = document.querySelector('input[name="ethnicity"]:checked')?.value;
		if (ethnicityInput && coords.ethnicity[ethnicityInput]) {
		  const { page, x, y } = coords.ethnicity[ethnicityInput];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}
		
		
		const sexInput = document.querySelector('input[name="sex"]:checked');
		if (sexInput && coords.sex && coords.sex[sexInput.value]) {
		  const { page, x, y } = coords.sex[sexInput.value];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}
		
		// Handle Physical Address Confirmation (sameAddress)
		// Only write if different mailing address is selected
		const sameAddressInput = document.querySelector('input[name="sameAddress"]:checked')?.value;
		if (sameAddressInput === "no") {
		  const newMailAddressInput = document.getElementById("newMailAddress")?.value;
		  if (newMailAddressInput && coords.newMailAddress) {
			const { page, x, y } = coords.newMailAddress;
			pages[page].drawText(newMailAddressInput, { x, y, size: 10, font });
		  }

		  const newMailCityInput = document.getElementById("newMailCity")?.value;
		  if (newMailCityInput && coords.newMailCity) {
			const { page, x, y } = coords.newMailCity;
			pages[page].drawText(newMailCityInput, { x, y, size: 10, font });
		  }

		  const newMailCountrySelect = document.getElementById("newMailCountry");
		  const selectedNewCountryCode = newMailCountrySelect?.value;
		  const selectedNewCountryName = newMailCountrySelect?.selectedOptions[0]?.textContent.trim();

		  if (selectedNewCountryName && coords.newMailCountry) {
			const { page, x, y } = coords.newMailCountry;
			pages[page].drawText(selectedNewCountryName, { x, y, size: 10, font });
		  }

		  if (selectedNewCountryCode === "US") {
			const newMailStateSelect = document.getElementById("newMailState");
			const newMailStateFullName = newMailStateSelect?.selectedOptions[0]?.textContent.trim();
			if (newMailStateFullName && coords.newMailState) {
			  const { page, x, y } = coords.newMailState;
			  pages[page].drawText(newMailStateFullName, { x, y, size: 10, font });
			}

			const newMailZipInput = document.getElementById("newMailZip")?.value;
			if (newMailZipInput && coords.newMailZip) {
			  const { page, x, y } = coords.newMailZip;
			  pages[page].drawText(newMailZipInput, { x, y, size: 10, font });
			}
		  } else {
			const newMailProvinceInput = document.getElementById("newMailState")?.value;
			if (newMailProvinceInput && coords.newMailProvince) {
			  const { page, x, y } = coords.newMailProvince;
			  pages[page].drawText(newMailProvinceInput, { x, y, size: 10, font });
			}

			const newMailPostalInput = document.getElementById("newMailZip")?.value;
			if (newMailPostalInput && coords.newMailPostal) {
			  const { page, x, y } = coords.newMailPostal;
			  pages[page].drawText(newMailPostalInput, { x, y, size: 10, font });
			}
		  }
		}





		// Race (multiple checkboxes)
		document.querySelectorAll('input[name="race"]:checked').forEach(el => {
		  const val = el.value;
		  if (coords.race[val]) {
			const { page, x, y } = coords.race[val];
			pages[page].drawText("X", { x, y, size: 10, font });
		  }
		});

		// Height (feet and inches)
		const heightFeet = document.getElementById("heightFeet")?.value;
		if (heightFeet && coords.heightFeet) {
		  pages[coords.heightFeet.page].drawText(heightFeet, {
			x: coords.heightFeet.x,
			y: coords.heightFeet.y,
			size: 10,
			font
		  });
		}

		const heightInches = document.getElementById("heightInches")?.value;
		if (heightInches && coords.heightInches) {
		  pages[coords.heightInches.page].drawText(heightInches, {
			x: coords.heightInches.x,
			y: coords.heightInches.y,
			size: 10,
			font
		  });
		}

		// Weight
		const weightInput = document.getElementById("weight");
		if (weightInput && weightInput.value) {
		  let weightValue = weightInput.value.replace(/\D/g, ""); // remove any non-digit
		  weightValue = weightValue.padStart(3, "0"); // pad to 3 digits if necessary

		  const baseX = coords.weight.x;
		  const y = coords.weight.y;
		  const page = coords.weight.page;

		  for (let i = 0; i < Math.min(3, weightValue.length); i++) {
			const digit = weightValue[i];
			if (digit && pages[page]) {
			  pages[page].drawText(digit, { x: baseX + i * 18, y, size: 10, font });
			  // ^ move x by ~20 units for each next box
			}
		  }
		}


		// Eye Color (radio)
		const eyeColor = document.querySelector('input[name="eyeColor"]:checked')?.value;
		if (eyeColor && coords.eyeColor[eyeColor]) {
		  const { page, x, y } = coords.eyeColor[eyeColor];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}

		// Hair Color (radio)
		const hairColor = document.querySelector('input[name="hairColor"]:checked')?.value;
		if (hairColor && coords.hairColor[hairColor]) {
		  const { page, x, y } = coords.hairColor[hairColor];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}
		
		const q12_newcard = document.querySelector('input[name="q12_newcard"]:checked')?.value;
		if (q12_newcard && coords.q12_newcard && coords.q12_newcard[q12_newcard]) {
		  const { page, x, y } = coords.q12_newcard[q12_newcard];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}
		
		
		const q12_consent = document.querySelector('input[name="q12_consent"]:checked')?.value;
		if (q12_consent && coords.q12_consent && coords.q12_consent[q12_consent]) {
		  const { page, x, y } = coords.q12_consent[q12_consent];
		  pages[page].drawText("X", { x, y, size: 10, font });
		}


	  
	  const uscisEl = document.getElementById("uscisAccount");
		if (uscisEl && coords.uscisAccount) {
		  const { page, x, y } = coords.uscisAccount;
		  if (pages[page] && uscisEl.value.trim()) {
			pages[page].drawText(uscisEl.value.trim(), { x, y, size: 10, font });
		  }
		}

      const prDateEl = document.getElementById("permanentResidentDate");
		if (prDateEl && coords.permanentResidentDate) {
		  const { page, x, y } = coords.permanentResidentDate;
		  const rawDate = prDateEl.value;
		  let formattedDate = "";
		  if (rawDate) {
			const [year, month, day] = rawDate.split("-");
			formattedDate = `${month}/${day}/${year}`;
		  }
		  if (pages[page] && formattedDate) {
			pages[page].drawText(formattedDate, { x, y, size: 10, font });
		  }
		}
		
		const birthCountryEl = document.getElementById("birthCountry");
		if (birthCountryEl && coords.birthCountry) {
		  const { page, x, y } = coords.birthCountry;
		  if (pages[page] && birthCountryEl.value.trim()) {
			pages[page].drawText(birthCountryEl.value.trim(), { x, y, size: 10, font });
		  }
		}

		const citizenshipCountryEl = document.getElementById("citizenshipCountry");
		if (citizenshipCountryEl && coords.citizenshipCountry) {
		  const { page, x, y } = coords.citizenshipCountry;
		  if (pages[page] && citizenshipCountryEl.value.trim()) {
			pages[page].drawText(citizenshipCountryEl.value.trim(), { x, y, size: 10, font });
		  }
		}



	  const aNumberEl = document.getElementById("aNumber");
		if (aNumberEl && coords.aNumberMulti) {
		  let value = aNumberEl.value.replace(/\D/g, "").replace(/^(\d{3})(\d{3})(\d{3})$/, "$1-$2-$3");
		  coords.aNumberMulti.forEach(({ page, x, y }) => {
			if (pages[page] && value) {
			  pages[page].drawText(value, { x, y, size: 10, font });
			}
		  });
		}
		
		
		const mailAddressInput = document.getElementById("mailAddress")?.value;
		if (mailAddressInput && coords.mailAddress) {
		  const { page, x, y } = coords.mailAddress;
		  pages[page].drawText(mailAddressInput, { x, y, size: 10, font });
		}

		const mailCityInput = document.getElementById("mailCity")?.value;
		if (mailCityInput && coords.mailCity) {
		  const { page, x, y } = coords.mailCity;
		  pages[page].drawText(mailCityInput, { x, y, size: 10, font });
		}

		const mailCountryInput = document.getElementById("mailCountry")?.value;
		if (mailCountryInput) {
		  if (mailCountryInput === "US") {
			const mailStateInput = document.getElementById("mailState")?.value;
			if (mailStateInput && coords.mailState) {
			  const { page, x, y } = coords.mailState;
			  pages[page].drawText(mailStateInput, { x, y, size: 10, font });
			}
			const mailZipInput = document.getElementById("zip")?.value;
			if (mailZipInput && coords.mailZip) {
			  const { page, x, y } = coords.mailZip;
			  pages[page].drawText(mailZipInput, { x, y, size: 10, font });
			}
		  } else {
			const mailProvinceInput = document.getElementById("mailState")?.value;
			if (mailProvinceInput && coords.mailProvince) {
			  const { page, x, y } = coords.mailProvince;
			  pages[page].drawText(mailProvinceInput, { x, y, size: 10, font });
			}
			const mailPostalInput = document.getElementById("zip")?.value;
			if (mailPostalInput && coords.mailPostal) {
			  const { page, x, y } = coords.mailPostal;
			  pages[page].drawText(mailPostalInput, { x, y, size: 10, font });
			}
		  }
		}
		
		



	  
		const drawField = (fieldId, fieldName) => {
		  const el = document.getElementById(fieldId);
		  if (!el) return; // Skip if field doesn't exist

		  let value;
		  if (fieldId === "mailCountry") {
			value = el.options[el.selectedIndex].text;
		  } else {
			value = el.value;

			if (fieldId === "ssn") {
			  value = formatSSN(value);
			} else if (fieldId === "aNumber") {
				  value = el.value.replace(/\D/g, "").replace(/^(\d{3})(\d{3})(\d{3})$/, "$1-$2-$3");
				} else if (fieldId === "phone") {
			  value = formatPhone(value);
			} else if (fieldId === "dob") {
			  const parts = value.split("-");
			  if (parts.length === 3) {
				value = `${parts[1]}/${parts[2]}/${parts[0]}`; // MM/DD/YYYY
			  }
			}
		  }

		  if (coords && coords[fieldName] && value) {
			if (coords[fieldName].page !== undefined) {
			  const { page, x, y } = coords[fieldName];
			  if (pages[page]) {
				pages[page].drawText(value, { x, y, size: 10, font });
			  }
			}
		  }
		};

      
      drawField("firstName", "firstName");
      drawField("middleName", "middleName");
      drawField("lastName", "lastName");
	  drawField("newFirstName", "newFirstName");
	  drawField("newMiddleName", "newMiddleName");
	  drawField("newLastName", "newLastName");
      drawField("ssn", "ssn");
	  drawField("dob", "dob");
	  drawField("aNumber", "aNumber");
      drawField("phone", "phone");
      drawField("email", "email");
      drawField("mailCountry", "mailCountry");
      drawField("mailAddress", "mailAddress");
      drawField("mailCity", "mailCity");
	
	  

      if (document.getElementById("mailCountry").value === "US") {
        drawField("mailState", "mailState");
        drawField("mailZip", "mailZip");
      } else {
        drawField("mailProvince", "mailProvince");
        drawField("mailPostal", "mailPostal");
      }
	  
		const selectedReason = document.querySelector('input[name="reason"]:checked');
		if (selectedReason && coords.reason && coords.reason[selectedReason.value]) {
		  const { page, x, y } = coords.reason[selectedReason.value];
		  pages[page].drawText("X", { x, y, size: 10, font });

		  if (selectedReason.value === "D") {
			const val = document.getElementById("reasonDLocation").value;
			if (val && coords.reasonDLocation) {
			  const { page, x, y } = coords.reasonDLocation;
			  pages[page].drawText(val, { x, y, size: 10, font });
			}
		  }

		  if (selectedReason.value === "G") {
			const val = document.getElementById("reasonGText").value;
			if (val && coords.reasonGText) {
			  const { page, x, y } = coords.reasonGText;
			  pages[page].drawText(val, { x, y, size: 10, font });
			}
		  }
		}


      
      // Process each yes/no question individually.
      // Only draw an "X" if a radio button is selected.
      const processQuestion = (questionName) => {
        const input = document.querySelector(`input[name="${questionName}"]:checked`);
        if (input && coords[questionName] && coords[questionName][input.value]) {
          const { page, x, y } = coords[questionName][input.value];
          pages[page].drawText("X", { x, y, size: 10, font });
        }
      };
	  
	  processQuestion("q_10parent");
	  processQuestion("q_11phys");

      
      processQuestion("q_1");
      processQuestion("q_2");
      processQuestion("q_3");
      processQuestion("q_4");
      processQuestion("q_5a");
      processQuestion("q_5b");
      processQuestion("q_6a");
      processQuestion("q_6b");
      processQuestion("q_6c");
      processQuestion("q_7a");
      processQuestion("q_7b");
      processQuestion("q_7c");
      processQuestion("q_7d");
      processQuestion("q_7e");
      processQuestion("q_7f");
      processQuestion("q_7g");
      processQuestion("q_8a");
      processQuestion("q_8b");
      processQuestion("q_9");
      processQuestion("q_10a");
      processQuestion("q_10b");
      processQuestion("q_10c");
      processQuestion("q_11");
      processQuestion("q_12");
      processQuestion("q_13");
      processQuestion("q_14");
      processQuestion("q_15a");
      processQuestion("q_15b");
      processQuestion("q_16");
      processQuestion("q_17a");
      processQuestion("q_17b");
      processQuestion("q_17c");
      processQuestion("q_17d");
      processQuestion("q_17e");
      processQuestion("q_17f");
      processQuestion("q_17g");
      processQuestion("q_17h");
      processQuestion("q_18");
      processQuestion("q_19");
      processQuestion("q_20");
      processQuestion("q_21");
      processQuestion("q_22a");
      processQuestion("q_22b");
      processQuestion("q_23");
      processQuestion("q_24");
      processQuestion("q_25");
      processQuestion("q_26a");
	  processQuestion("q_26b");
      processQuestion("q_26c");
      processQuestion("q_26d");
      processQuestion("q_27");
      processQuestion("q_28");
      processQuestion("q_29");
      processQuestion("q_30a");
      processQuestion("q_30b");
      processQuestion("q_31");
      processQuestion("q_32");
      processQuestion("q_33");
      processQuestion("q_34");
      processQuestion("q_35");
      processQuestion("q_36");
      processQuestion("q_37");
      
      const pdfBytes = await pdfDoc.save();
	  latestFilledPdfBytes = pdfBytes;

      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      pdfPreview.src = URL.createObjectURL(blob);
    }
    
    // Allow radio buttons to be deselected when clicked again.
    document.querySelectorAll('input[type="radio"]').forEach((radio) => {
      radio.addEventListener('mousedown', function() {
        this.wasChecked = this.checked;
      });
      radio.addEventListener('click', function(e) {
        if (this.wasChecked) {
          this.checked = false;
          this.wasChecked = false;
          e.stopPropagation();
        }
      });
    });
	
	function validateInputs() {
  let errors = [];

  // Validate A-Number (9 digits)
  const aNumber = document.getElementById("aNumber")?.value.replace(/\D/g, "");
  if (aNumber && aNumber.length !== 9) {
    errors.push("A-Number must be exactly 9 digits.");
  }

  // Validate USCIS Online Account Number (12 digits)
  const uscisAccount = document.getElementById("uscisAccount")?.value.replace(/\D/g, "");
  if (uscisAccount && uscisAccount.length !== 12) {
    errors.push("USCIS Online Account Number must be exactly 12 digits.");
  }

  // Validate Phone Number (10 digits)
  const phone = document.getElementById("phone")?.value.replace(/\D/g, "");
  if (phone && phone.length !== 10) {
    errors.push("Phone number must be exactly 10 digits.");
  }

  // Validate SSN (9 digits)
  const ssn = document.getElementById("ssn")?.value.replace(/\D/g, "");
  if (ssn && ssn.length !== 9) {
    errors.push("Social Security Number must be exactly 9 digits.");
  }
  
// Validate ZIP (5 digits)
const zip = document.getElementById("zip")?.value.replace(/\D/g, "");
if (zip && zip.length !== 5) {
  errors.push("ZIP code must be exactly 5 digits.");
}


  // Show error messages
  const errorMessageDiv = document.getElementById("errorMessage");
  if (errors.length > 0) {
    errorMessageDiv.innerHTML = errors.join("<br>");
    return false;
  } else {
    errorMessageDiv.innerHTML = "";
    return true;
  }
}

    
updatePreviewBtn.addEventListener("click", async () => {
  if (!validateInputs()) {
    return;
  }
  await updatePreview();
});

    
    loadPDF(formSelect.value);
	
	document.querySelectorAll('input[name="reason"]').forEach((input) => {
		input.addEventListener("change", function () {
		document.getElementById("dDetails").style.display = (this.value === "D") ? "block" : "none";
		document.getElementById("gDetails").style.display = (this.value === "G") ? "block" : "none";
	});
	});
	
	
    
  </script>
  



<script>
  const formFieldIds = [
    //"firstName", "middleName", "lastName", "dob", "ssn", "aNumber",
    //"phone", "email", "mailAddress", "mailCity", "mailCountry", "mailZip",
    //"newFirstName", "newMiddleName", "newLastName", "uscisAccount","permanentResidentDate",
	//"birthCountry", "citizenshipCountry", "heightFeet", "heightInches", "weight", "sex"

  ];

  function saveFormDataToLocalStorage() {
    const data = {};
    formFieldIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });

    // Also handle radio button for legalNameChange
    const legalNameChange = document.querySelector('input[name="legalNameChange"]:checked');
    if (legalNameChange) data.legalNameChange = legalNameChange.value;

    localStorage.setItem("uscisFormData", JSON.stringify(data));
  }

  function loadFormDataFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem("uscisFormData") || "{}");
    formFieldIds.forEach(id => {
      const el = document.getElementById(id);
      if (el && data[id]) el.value = data[id];
    });

    // Restore radio button
    if (data.legalNameChange) {
      const radio = document.querySelector(`input[name="legalNameChange"][value="${data.legalNameChange}"]`);
      if (radio) radio.checked = true;
      document.getElementById("newLegalNameFields").style.display = (data.legalNameChange === "yes") ? "block" : "none";
    }
  }

  // Hook into user interaction
  window.addEventListener("DOMContentLoaded", () => {
    loadFormDataFromLocalStorage();

    const allInputs = document.querySelectorAll("input, select");
    allInputs.forEach(input => {
      input.addEventListener("input", saveFormDataToLocalStorage);
      input.addEventListener("change", saveFormDataToLocalStorage);
    });
  });
</script>
<script type="module" src="./main.js"></script>

<script>
  document.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      e.preventDefault(); // prevent form submission or accidental reload
      const updateBtn = document.getElementById("updatePreviewBtn");
      if (updateBtn) updateBtn.click();
    }
  });
  
</script>
<script>
	document.querySelectorAll(".collapsible-toggle").forEach(btn => {
	  btn.addEventListener("click", () => {
		const content = btn.closest(".collapsible-section").querySelector(".collapsible-content");
		const collapsed = content.classList.toggle("collapsed");
		btn.innerText = collapsed ? "Expand" : "Collapse";
	  });
	});
</script>


<script>
// Show/hide SSA sections depending on 12a answer
document.querySelectorAll('input[name="q12_newcard"]').forEach((elem) => {
  elem.addEventListener('change', function() {
    const ssaNewCardSection = document.getElementById('ssaNewCardSection');
    const ssaConsentSection = document.getElementById('ssaConsentSection');
    const ssnFieldset = document.querySelector('#ssn')?.closest('fieldset');

    if (this.value === "yes") {
      if (ssaNewCardSection) ssaNewCardSection.style.display = 'block';
      if (ssaConsentSection) ssaConsentSection.style.display = 'block';
      if (ssnFieldset) ssnFieldset.style.display = 'block';
    } else if (this.value === "no") {
      if (ssaNewCardSection) ssaNewCardSection.style.display = 'none';
      if (ssaConsentSection) ssaConsentSection.style.display = 'none';
      if (ssnFieldset) ssnFieldset.style.display = 'none';
    }
  });
});

// Initialize on page load
window.addEventListener('DOMContentLoaded', () => {
  const checked = document.querySelector('input[name="q12_newcard"]:checked');
  const ssaNewCardSection = document.getElementById('ssaNewCardSection');
  const ssaConsentSection = document.getElementById('ssaConsentSection');
  const ssnFieldset = document.querySelector('#ssn')?.closest('fieldset');

  if (!checked) {
    // No radio button selected at page load — hide everything
    if (ssaNewCardSection) ssaNewCardSection.style.display = 'none';
    if (ssaConsentSection) ssaConsentSection.style.display = 'none';
    if (ssnFieldset) ssnFieldset.style.display = 'none';
  } else {
    // If already selected, trigger behavior
    checked.dispatchEvent(new Event('change'));
  }
});
</script>

<script>
// Function to update New Mailing Address state field based on country selection
function updateNewStateField() {
  const newCountrySelect = document.getElementById('newMailCountry');
  const newStateContainer = document.getElementById('newMailStateContainer');

  if (newCountrySelect.value === "US") {
    const select = document.createElement('select');
    select.id = 'newMailState';
select.innerHTML = `
  <option value="">Select a State</option>
  <option value="AL">Alabama</option>
  <option value="AK">Alaska</option>
  <option value="AZ">Arizona</option>
  <option value="AR">Arkansas</option>
  <option value="CA">California</option>
  <option value="CO">Colorado</option>
  <option value="CT">Connecticut</option>
  <option value="DE">Delaware</option>
  <option value="FL">Florida</option>
  <option value="GA">Georgia</option>
  <option value="HI">Hawaii</option>
  <option value="ID">Idaho</option>
  <option value="IL">Illinois</option>
  <option value="IN">Indiana</option>
  <option value="IA">Iowa</option>
  <option value="KS">Kansas</option>
  <option value="KY">Kentucky</option>
  <option value="LA">Louisiana</option>
  <option value="ME">Maine</option>
  <option value="MD">Maryland</option>
  <option value="MA">Massachusetts</option>
  <option value="MI">Michigan</option>
  <option value="MN">Minnesota</option>
  <option value="MS">Mississippi</option>
  <option value="MO">Missouri</option>
  <option value="MT">Montana</option>
  <option value="NE">Nebraska</option>
  <option value="NV">Nevada</option>
  <option value="NH">New Hampshire</option>
  <option value="NJ">New Jersey</option>
  <option value="NM">New Mexico</option>
  <option value="NY">New York</option>
  <option value="NC">North Carolina</option>
  <option value="ND">North Dakota</option>
  <option value="OH">Ohio</option>
  <option value="OK">Oklahoma</option>
  <option value="OR">Oregon</option>
  <option value="PA">Pennsylvania</option>
  <option value="RI">Rhode Island</option>
  <option value="SC">South Carolina</option>
  <option value="SD">South Dakota</option>
  <option value="TN">Tennessee</option>
  <option value="TX">Texas</option>
  <option value="UT">Utah</option>
  <option value="VT">Vermont</option>
  <option value="VA">Virginia</option>
  <option value="WA">Washington</option>
  <option value="WV">West Virginia</option>
  <option value="WI">Wisconsin</option>
  <option value="WY">Wyoming</option>
`;

    newStateContainer.innerHTML = '';
    newStateContainer.appendChild(select);
  } else {
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'newMailState';
    newStateContainer.innerHTML = '';
    newStateContainer.appendChild(input);
  }
}

// Attach the function to the country select change event
document.getElementById('newMailCountry').addEventListener('change', updateNewStateField);

// Initialize correct state field on page load
window.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('newMailCountry')) {
    updateNewStateField();
  }
});
</script>

<script>
// Show/hide Different Mailing Address fieldset based on sameAddress radio selection
document.querySelectorAll('input[name="sameAddress"]').forEach((elem) => {
  elem.addEventListener('change', function() {
    const differentMailing = document.getElementById('differentMailingAddress');
    if (this.value === "no") {
      differentMailing.style.display = 'block';
    } else {
      differentMailing.style.display = 'none';
    }
  });
});

// Initialize on page load
window.addEventListener('DOMContentLoaded', () => {
  const checked = document.querySelector('input[name="sameAddress"]:checked');
  if (checked && checked.value === "no") {
    document.getElementById('differentMailingAddress').style.display = 'block';
  }
});
</script>


<script>
// Function to update the different mailing address state field based on selected country
function updateNewStateField() {
  const newCountrySelect = document.getElementById('newMailCountry');
  const newStateContainer = document.getElementById('newMailStateContainer');

  if (!newCountrySelect || !newStateContainer) return;

  if (newCountrySelect.value === "US") {
    const select = document.createElement('select');
    select.id = 'newMailState';
    select.innerHTML = `
      <option value="AL">Alabama</option>
      <option value="AK">Alaska</option>
      <option value="AZ">Arizona</option>
      <option value="AR">Arkansas</option>
      <option value="CA">California</option>
      <option value="CO">Colorado</option>
      <option value="CT">Connecticut</option>
      <option value="DE">Delaware</option>
      <option value="FL">Florida</option>
      <option value="GA">Georgia</option>
      <option value="HI">Hawaii</option>
      <option value="ID">Idaho</option>
      <option value="IL">Illinois</option>
      <option value="IN">Indiana</option>
      <option value="IA">Iowa</option>
      <option value="KS">Kansas</option>
      <option value="KY">Kentucky</option>
      <option value="LA">Louisiana</option>
      <option value="ME">Maine</option>
      <option value="MD">Maryland</option>
      <option value="MA">Massachusetts</option>
      <option value="MI">Michigan</option>
      <option value="MN">Minnesota</option>
      <option value="MS">Mississippi</option>
      <option value="MO">Missouri</option>
      <option value="MT">Montana</option>
      <option value="NE">Nebraska</option>
      <option value="NV">Nevada</option>
      <option value="NH">New Hampshire</option>
      <option value="NJ">New Jersey</option>
      <option value="NM">New Mexico</option>
      <option value="NY">New York</option>
      <option value="NC">North Carolina</option>
      <option value="ND">North Dakota</option>
      <option value="OH">Ohio</option>
      <option value="OK">Oklahoma</option>
      <option value="OR">Oregon</option>
      <option value="PA">Pennsylvania</option>
      <option value="RI">Rhode Island</option>
      <option value="SC">South Carolina</option>
      <option value="SD">South Dakota</option>
      <option value="TN">Tennessee</option>
      <option value="TX">Texas</option>
      <option value="UT">Utah</option>
      <option value="VT">Vermont</option>
      <option value="VA">Virginia</option>
      <option value="WA">Washington</option>
      <option value="WV">West Virginia</option>
      <option value="WI">Wisconsin</option>
      <option value="WY">Wyoming</option>
    `;
    newStateContainer.innerHTML = '';
    newStateContainer.appendChild(select);
  } else {
    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'newMailState';
    newStateContainer.innerHTML = '';
    newStateContainer.appendChild(input);
  }
}

// Attach it to listen for changes on newMailCountry
document.getElementById('newMailCountry').addEventListener('change', updateNewStateField);

// Also initialize it when the page first loads
window.addEventListener('DOMContentLoaded', () => {
  if (document.getElementById('newMailCountry')) {
    updateNewStateField();
  }
});
</script>




</body>
</html>
